<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>XGBoost - VHC-TestDataScience-1</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">VHC-TestDataScience-1</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../data-cleaning/" class="nav-link">Data Cleaning</a>
                            </li>
                            <li class="nav-item">
                                <a href="../data-exploration/" class="nav-link">Data Exploration</a>
                            </li>
                            <li class="nav-item">
                                <a href="../feature-engineering/" class="nav-link">Feature Engineering</a>
                            </li>
                            <li class="nav-item">
                                <a href="../pre-processing/" class="nav-link">Pre-processing</a>
                            </li>
                            <li class="nav-item">
                                <a href="../modeling/" class="nav-link">Modeling</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">XGBoost</a>
                            </li>
                            <li class="nav-item">
                                <a href="../results/" class="nav-link">Results</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../modeling/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../results/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#xgboost" class="nav-link">XGBoost</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#hyperparameter-tuning" class="nav-link">Hyperparameter Tuning</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#smote" class="nav-link">SMOTE</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#matriz-de-confusion" class="nav-link">Matriz de Confusión</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#importancia-de-las-caracteristicas" class="nav-link">Importancia de las características</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#roc-auc" class="nav-link">ROC AUC</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#curvas-de-aprendizaje" class="nav-link">Curvas de Aprendizaje</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#curva-de-precision-recall" class="nav-link">Curva de Precisión-Recall</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="xgboost">XGBoost</h1>
<p>XGBoost es el modelo seleccionado para abordar esta tarea de clasificación. Ahora es el momento de comprender el modelo y encontrar los mejores hiperparámetros.</p>
<h2 id="hyperparameter-tuning"><strong>Hyperparameter Tuning</strong></h2>
<p>Primero, se optimiza el modelo para mejorar su rendimiento. Este modelo ajustado funciona mejor que el original, pero aún presenta dificultades para clasificar las clases minoritarias, como la clase 4, que corresponde al defecto "suciedad" y tiene muy pocas observaciones en el conjunto de datos. Para solucionar este problema, es necesario aplicar una técnica de muestreo. Dado que las observaciones son escasas, decidí utilizar la técnica <strong>SMOTE</strong> para mejorar la clasificación.</p>
<pre><code class="language-python"># Define the model
model = xgb.XGBClassifier(random_state = 42)

# Define the hyperparameter grid
param_grid = {&quot;max_depth&quot;: [3, 5, 7],
              &quot;learning_rate&quot;: [0.01, 0.1, 0.2],
              &quot;n_estimators&quot;: [100, 200, 300],
              &quot;subsample&quot;: [0.6, 0.8, 1.0]}

# Set up Grid Search
grid_search = GridSearchCV(estimator = model, 
                           param_grid = param_grid,
                           scoring = &quot;f1_macro&quot;,
                           cv = 3,
                           verbose = 1,
                           n_jobs = -1)

# Fit the model
grid_search.fit(X_train_scaled, y_train)

# Print the best parameters and score
print(&quot;Best Parameters:&quot;, grid_search.best_params_)
print(&quot;Best Score:&quot;, grid_search.best_score_)

# Evaluate on the test set
best_model = grid_search.best_estimator_
y_pred = best_model.predict(X_test_scaled)
print(classification_report(y_test, y_pred))
</code></pre>
<h2 id="smote"><strong>SMOTE</strong></h2>
<p>SMOTE es una técnica de re-muestreo que crea nuevas muestras ajustando ligeramente los datos existentes hacia sus vecinos. Funciona eligiendo aleatoriamente una muestra de la clase minoritaria, identificando sus k vecinos más cercanos y generando nuevos puntos de datos al escalar la distancia hacia esos vecinos. De esta manera, se mantiene la integridad de la clase minoritaria y se enriquece el conjunto de datos.</p>
<p>Una vez dividido el conjunto de datos en entrenamiento y prueba, aplicamos SMOTE <strong>solamente</strong> al conjunto de entrenamiento. Esto asegura que el conjunto de prueba siga siendo una representación fiel de la distribución original de los datos y previene cualquier filtración de información desde el conjunto de entrenamiento. Así, garantizamos que el proceso de evaluación sea más sólido y confiable.</p>
<pre><code class="language-python"># Apply SMOTE to the training data
smote = SMOTE(random_state = 42)
X_resampled, y_resampled = smote.fit_resample(X_train_scaled, y_train)

# Fit the XGBoost model on the resampled data
xgb_smote_model = XGBClassifier(random_state = 42)
xgb_smote_model.fit(X_resampled, y_resampled)

# Evaluate the model on the test set
xgb_smote_pred = xgb_smote_model.predict(X_test_scaled)
print(classification_report(y_test, xgb_smote_pred))
</code></pre>
<p>El modelo XGBoost con SMOTE se destaca claramente como el mejor en comparación con el modelo XGBoost ajustado, logrando una precisión del 80% y un F1-score macro promedio de 0.80. Aunque la precisión de ambos modelos es similar, uno de los puntos fuertes de este modelo es la capacidad para identificar eficazmente instancias de clases minoritarias, como la clase 4, donde logró un valor de recall del 88%, mientras que el modelo original alcanzó 62% y el ajustado solo alcanzó el 50%.</p>
<p>Además, el modelo SMOTE muestra un rendimiento constante en las clases mayoritarias, lo que demuestra su fiabilidad y un rendimiento bastante sólido en general. Esto lo convierte en la mejor opción para aplicaciones del mundo real, especialmente en conjuntos de datos desbalanceados donde cada clase es importante.</p>
<pre><code class="language-python"># Save the trained model as pickle format
with open(&quot;../model/xgboost_model.pkl&quot;, &quot;wb&quot;) as file:
    pickle.dump(xgb_model, file)
# Save the trained model as a json file
xgb_model.save_model(&quot;../model/xgboost_model.json&quot;)
</code></pre>
<h2 id="matriz-de-confusion"><strong>Matriz de Confusión</strong></h2>
<p>Analizar la matriz de confusión nos ayuda a comprender las clasificaciones incorrectas y a identificar áreas potenciales de mejora. </p>
<pre><code class="language-python"># Plot XGBoost Confusion Matrix
xgb_smote_model_cm = confusion_matrix(y_test, xgb_predictions)
ConfusionMatrixDisplay(confusion_matrix = xgb_smote_model_cm).plot(cmap = &quot;PuBu&quot;)
plt.title(&quot;Matriz de confusión del modelo XGBoost&quot;)
plt.xlabel(&quot;Predicción&quot;)
plt.ylabel(&quot;Valor real&quot;)
</code></pre>
<h2 id="importancia-de-las-caracteristicas"><strong>Importancia de las características</strong></h2>
<p>Identificar las características clave que impulsan las predicciones es fundamental para comprender cómo el modelo toma decisiones.</p>
<pre><code class="language-python"># Plot feature importance
xgboost_feature_importance = plt.figure(figsize = (15, 3))
xgb.plot_importance(xgb_smote_model,
                    importance_type = &quot;weight&quot;,
                    color = &quot;#74add1&quot;,
                    title = &quot;Importancia de características de XGBoost&quot;,
                    xlabel = &quot;Peso&quot;,
                    ylabel = &quot;Características&quot;)
</code></pre>
<h2 id="roc-auc"><strong>ROC AUC</strong></h2>
<p>Evalúa el rendimiento del modelo de manera integral.</p>
<pre><code class="language-python"># Binarize the output
y_bin = label_binarize(y_test, classes = [0, 1, 2, 3, 4, 5, 6])
y_score = xgb_smote_model.predict_proba(X_test_scaled)

# Compute ROC AUC for each class
roc_auc = roc_auc_score(y_bin, y_score, average = &quot;macro&quot;)
print(f&quot;XGBoost Model ROC AUC Score: {roc_auc:.2f}&quot;)
# Binarize the output
y_bin = label_binarize(y_test, classes = [0, 1, 2, 3, 4, 5, 6])
n_classes = y_bin.shape[1]

# Compute ROC curve and ROC area for each class
fpr = dict()
tpr = dict()
roc_auc = dict()

for i in range(n_classes):
    fpr[i], tpr[i], _ = roc_curve(y_bin[:, i], xgb_smote_model.predict_proba(X_test_scaled)[:, i])
    roc_auc[i] = auc(fpr[i], tpr[i])

# Plot the curves
plt.figure(figsize = (11, 4))
for i in range(n_classes):
    plt.plot(fpr[i], tpr[i], color = colors[i], label = &quot;ROC curve of class {0} (area = {1:0.2f})&quot;.format(i, roc_auc[i]))

plt.plot([0, 1], [0, 1], &quot;k--&quot;)
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel(&quot;Tasa de Falsos Positivos&quot;)
plt.ylabel(&quot;Tasa de Verdaderos Positivos&quot;)
plt.title(&quot;Curva Característica de Operación del Receptor (ROC)&quot;)
plt.legend(loc = &quot;lower right&quot;)
</code></pre>
<h2 id="curvas-de-aprendizaje"><strong>Curvas de Aprendizaje</strong></h2>
<p>Evalúa el comportamiento del entrenamiento del modelo y detecta problemas de sesgo.</p>
<pre><code class="language-python"># Plot the learning curves of the model
plt.figure(figsize = (11, 4))

train_sizes, train_scores, test_scores = learning_curve(xgb_smote_model, X_resampled, y_resampled, cv = 5, n_jobs = -1, train_sizes = np.linspace(0.1, 1.0, 10))
train_scores_mean = train_scores.mean(axis = 1)
test_scores_mean = test_scores.mean(axis = 1)

plt.plot(train_sizes, train_scores_mean, color = &quot;#74add1&quot;, label = &quot;Puntuación de entrenamiento&quot;)
plt.plot(train_sizes, test_scores_mean, color = &quot;#f46d43&quot;, label = &quot;Puntuación de validación cruzada&quot;)
plt.title(&quot;Curva de aprendizaje del modelo XGBoost&quot;)
plt.xlabel(&quot;Tamaño de entrenamiento&quot;)
plt.ylabel(&quot;Puntuación&quot;)
plt.legend(loc = &quot;best&quot;)
</code></pre>
<h2 id="curva-de-precision-recall"><strong>Curva de Precisión-Recall</strong></h2>
<p>Evalúa el rendimiento del modelo en términos de precisión y recuperación, especialmente útil en casos de clases desbalanceadas.</p>
<pre><code class="language-python"># Plot the precision-recall curve
plt.figure(figsize=(11, 4))
for i in range(n_classes):
    precision, recall, _ = precision_recall_curve(y_bin[:, i], xgb_smote_model.predict_proba(X_test_scaled)[:, i])
    plt.plot(recall, precision, color = colors[i], label = f&quot;Curva de Precisión-Recuperación de la clase {i}&quot;)
plt.xlabel(&quot;Recuperación&quot;)
plt.ylabel(&quot;Precisión&quot;)
plt.title(&quot;Curva de Precisión-Recuperación&quot;)
plt.legend(loc = &quot;lower left&quot;)
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
